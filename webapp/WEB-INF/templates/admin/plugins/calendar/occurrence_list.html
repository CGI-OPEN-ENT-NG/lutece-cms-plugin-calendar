<#function isDayExcluded nDay listExcludedDays>
	<#list listExcludedDays as excludedDay>
		<#if excludedDay == nDay>
			<#return true>
		</#if>
	</#list>
	<#return false>
</#function>

<div class="row-fluid">
	<div class="span12">
		<form class="form-inline" method="post" action="jsp/admin/plugins/calendar/DoModifyOccurrencePeriodicity.jsp">
		<input type="hidden" name="event_id" value="${event.id}" />
		<input type="hidden" name="calendar_id" value="${calendar_id}" />
		<label class="inline">#i18n{calendar.modify_event.periodicity}</label>
		<@comboWithParams name="periodicity" default_value="${number_days}" additionalParameters=" tabindex=\"1\" class=\"input-normal\"" items=interval_list />
		<span class="help-text">#i18n{calendar.modify_event.labelStartingDateStart}</span>
		<label class="inline"> #i18n{calendar.modify_event.occurrence} </label>
		<input type="text" id="occurrence" name="occurrence" value="${event.occurrence}" tabindex="2" class="input-mini" maxlength="3" >
		<hr>
		<div class="well">
            <label for="excluded_days">#i18n{calendar.modify_event.excluded_days} : </label>
            <label class="checkbox inline">
                <input tabindex="3" type="checkbox" value="2" name="excluded_days" <#if isDayExcluded("2", event.excludedDays)> checked="checked" </#if>>#i18n{calendar.label.monday}
            </label>
            <label class="checkbox inline">
				<input tabindex="4" type="checkbox" class="checkbox" value="3" name="excluded_days" <#if isDayExcluded("3", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.tuesday}
            </label>
            <label class="checkbox inline">
				<input tabindex="5" type="checkbox" class="checkbox" value="4" name="excluded_days" <#if isDayExcluded("4", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.wednesday}
            </label>
            <label class="checkbox inline">
				<input tabindex="6" type="checkbox" class="checkbox" value="5" name="excluded_days" <#if isDayExcluded("5", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.thursday}
            </label>
            <label class="checkbox inline">
				<input tabindex="7" type="checkbox" class="checkbox" value="6" name="excluded_days" <#if isDayExcluded("6", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.friday}
            </label>
            <label class="checkbox inline">
				<input tabindex="8" type="checkbox" class="checkbox" value="7" name="excluded_days" <#if isDayExcluded("7", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.saturday}
            </label>    
            <label class="checkbox inline">
				<input tabindex="9" type="checkbox" class="checkbox" value="1" name="excluded_days" <#if isDayExcluded("1", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.sunday}
            </label>
        </div>
       	<button tabindex="10" class="btn btn-primary btn-small" type="submit" >
			<i class="icon-ok icon-white"></i>&nbsp;#i18n{calendar.modify_event.buttonLabelmodify}
		</button>
       	<a class="btn" tabindex="11" href="jsp/admin/plugins/calendar/EventList.jsp?plugin_name=calendar&calendar_id=${calendar_id}">
			<i class="icon-remove-circle"></i>&nbsp;#i18n{calendar.modify_event.backToEventList}
		</a>
       	</fieldset>
	</form>
	<fieldset>
		<legend>#i18n{calendar.modify_occurrence.ListOccurrence}</legend>
		<@paginationAdmin paginator=paginator combo=1 />
		<form class="form" method="post" action="jsp/admin/plugins/calendar/ModifyOccurrenceList.jsp" name="form_modify_occurrence">
		<input type="hidden" name="plugin_name" value="calendar" /> 
        <input type="hidden" name="calendar_id" value="${calendar_id}" />   
       	<input type="hidden" name="event_id" value="${event.id}" />
       	
	    <table class="table table-striped table-condensed">
	        <tr>
				 <th>
					<label class="checkbox">
						<input tabindex="12"  type="checkbox" id="cbx_0" name="cbx_check">
						#i18n{calendar.modify_occurrence.columnEventTitle}
						<@sort jsp_url="jsp/admin/plugins/calendar/OccurrenceList.jsp" attribute="title&calendar_id=${calendar_id}&event_id=${event.id}" />
					</label>	
	            </th>   
	            <th>
	            	#i18n{calendar.modify_occurrence.columnEventDate}
					<@sort jsp_url="jsp/admin/plugins/calendar/OccurrenceList.jsp" attribute="date&calendar_id=${calendar_id}&event_id=${event.id}" />
	            </th>
	            <th>
	            	#i18n{calendar.modify_event.status}
	            	<@sort jsp_url="jsp/admin/plugins/calendar/OccurrenceList.jsp" attribute="status&calendar_id=${calendar_id}&event_id=${event.id}" />
	            </th>           
	            <th>
	            	#i18n{calendar.modify_occurrence.columnEventTimeStart}
	            	<@sort jsp_url="jsp/admin/plugins/calendar/OccurrenceList.jsp" attribute="dateTimeStart&calendar_id=${calendar_id}&event_id=${event.id}" />
	            </th>
	            <th>
	            	#i18n{calendar.modify_occurrence.columnEventTimeEnd}
	            	<@sort jsp_url="jsp/admin/plugins/calendar/OccurrenceList.jsp" attribute="dateTimeEnd&calendar_id=${calendar_id}&event_id=${event.id}" />
	            </th>
	                   
	            <th>#i18n{calendar.modify_occurrence.columnEventActions}</th>
	        </tr> 
	        <#assign i=13>                
	        <#list occurrence_list as occurrence >
	        <tr>
				 <td>
					<label class="checkbox">
						<input tabindex="${i}" type="checkbox" id="cbx_occurrence_${i}" name="cbx_occurrence" class="checkbox cbx_occurence" value="${occurrence.id}" >
						${occurrence.title}
					</label>		
	            </td>
				<td>
				  ${occurrence.date?date}
	            </td>
	            <td>
	                <#if occurrence.status?exists>
						<#switch occurrence.status>
						  <#case "confirmed">
						    #i18n{calendar.event.status.confirmed.value}
						    <#break>
						  <#case "tentative">
						    #i18n{calendar.event.status.tentative.value}
						    <#break>
						  <#case "cancelled">
						    #i18n{calendar.event.status.cancelled.value}
						    <#break>
						</#switch>
	                </#if>
	            </td>
	            <td>
	                <#if occurrence.dateTimeStart?exists>
	                ${occurrence.dateTimeStart}
	                </#if>
	            </td>
	            <td>
	                <#if occurrence.dateTimeEnd?exists>
	                ${occurrence.dateTimeEnd}
	                </#if>
	            </td>
	            <td>
					<a tabindex="${i + 1}" class="btn btn-primary btn-small" href="jsp/admin/plugins/calendar/ModifyOccurrence.jsp?plugin_name=calendar&calendar_id=${calendar_id}&event_id=${occurrence.eventId}&occurrence_id=${occurrence.id}"  title="null" >
						<i class="icon-edit icon-white"></i>
					</a>
	                <a tabindex="${i + 2}" class="btn btn-danger btn-small" href="jsp/admin/plugins/calendar/RemoveOccurrence.jsp?plugin_name=calendar&calendar_id=${calendar_id}&event_id=${occurrence.eventId}&occurrence_id=${occurrence.id}"  title="#i18n{calendar.modify_occurrence.actionDeleteEvent}" >
						<i class="icon-trash icon-white"></i>
					</a>
	            </td>
	        </tr>
	        <#assign i=i+3>
	        </#list>
	    </table>
		<label>#i18n{calendar.modify_occurrence.labelStatus} </label>
	      <div class="controls">
			<@combo name="event_status" default_value="${default_status}" items=event_status_list />
		</div>
	    <div class="form-actions">
			<button tabindex="${i + 1}" class="btn btn-primary btn-small" type="submit" name="modify_occurrences_status" >
				<i class="icon-edit icon-white"></i>&nbsp;#i18n{calendar.modify_occurrence.buttonModify}
			</button>
			<button tabindex="${i + 2}" class="btn btn-danger btn-small" type="submit" name="remove_occurrences" >
				<i class="icon-trash icon-white"></i>&nbsp;#i18n{calendar.modify_occurrence.buttonDelete}
			</button>
		</div>
        </form>
    </fieldset>
		<@paginationAdmin paginator=paginator combo=1 />
	</div>
</div>

<script>
$(document).ready( function(){
	$("#cbx_0").click( function(){
		if( $(this).attr('checked') == 'checked' ){
			$("input:checkbox.cbx_occurence").attr('checked','checked');
		} else {
			$("input:checkbox.cbx_occurence").removeAttr('checked');
		}
	});
 });  

/*
function doCheckBox( ){
	
	//Retrieve a checkbox[] from the form
	allcheckBox = document.forms["form_modify_occurrence"].cbx_occurrence;

	//when the main checkbox is checked all the checkbox of the list are checked
	if(document.getElementById("cbx_0").checked )
	{	
		//if there are several checkbox	to check	
		if( allcheckBox.length > 0)
			for (i=0; i < allcheckBox.length ; ++i){
				document.getElementById("cbx_occurrence_" + i).checked = true;
				}
		//if there is just one checkbox to check		
		else
			document.getElementById("cbx_occurrence_0").checked = true;	
	}
	//when the main checkbox is checked all the uncheckbox of the list are unchecked
	else {
		if( allcheckBox.length > 0)
			for (i=0; i < allcheckBox.length ; ++i){
					document.getElementById("cbx_occurrence_"+i).checked = false;
				}			
		else
			document.getElementById("cbx_occurrence_0").checked = false;	
	}
}

function checkRadio( radio ){document.getElementById(radio).checked = true;}
*/
</script>