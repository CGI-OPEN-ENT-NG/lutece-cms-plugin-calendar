<#include "/admin/plugins/calendar/util/calendar.html" />
<#include "/admin/util/editor/editor.html" />

<#function isDayExcluded nDay listExcludedDays>
	<#list listExcludedDays as excludedDay>
		<#if excludedDay == nDay>
			<#return true>
		</#if>
	</#list>
	<#return false>
</#function>
<#escape x as x?html>
<div class="row-fluid">
	<form class="form" method="post" action="jsp/admin/plugins/calendar/ModifyEventConfirmation.jsp" name="form_modify_event" enctype="multipart/form-data">
	<input type="hidden" name="calendar_id" value="${calendar_id}" />   
	<input type="hidden" name="event_id" value="${event.id}" /> 
	<input type="hidden" name="sort_events" value="${default_sort_event}" />
	<input type="hidden" name="box" value="mandatory" />
	<div class="span8">
		<fieldset>
                <legend>#i18n{calendar.create_event.pageTitle}</legend>
                <div class="control-group">
                    <div class="controls form-inline">
                        <label for="event_title">#i18n{calendar.create_event.title} *</label>
                        <input type="text" id="event_title" name="event_title" tabindex="1" class="input-xxlarge" maxlength="60" value="${event.title}">
			            <label for="event_top_event">#i18n{calendar.create_event.topevent} *</label>
                        <@comboWithParams name="event_top" default_value="${top_event_default}" items=top_event_list additionalParameters="class=\"input-small\"" />
                    </div>
                </div>
                <div class="control-group">
                    <div class="controls">
                        <label  for="event_description">#i18n{calendar.modify_event.description} * :</label>
                        <textarea id="event_description" class="richtext" tabindex="3" name="event_description" style="width:60%" rows="4" >${event.description}</textarea>
                    </div>
                </div>
            </fieldset>
			<fieldset>
			<legend>#i18n{calendar.create_event.event_hour_and_time}</legend>
                <div class="row-fluid">
                    <div class="span12">
                        <div class="control-group">
                            <div class="controls form-inline">
                                <label  for="event_date">#i18n{calendar.create_event.date} *&nbsp;</label>
								<div class="input-prepend">
									<span class="add-on">
										<i class="icon-calendar"></i>
									</span>	
									<input type="text"  title=" (dd/MM/yyyy)" name="event_date" id="event_date" tabindex="4" class="input-small" value="${event.date?date}">
                                </div>
								<label  for="event_date_end">#i18n{calendar.create_event.date_end}&nbsp;</label>
								<div class="input-prepend">
								<span class="add-on">
									<i class="icon-calendar"></i>
								</span>	
								<input type="text" title=" (dd/MM/yyyy)" name="event_date_end" id="event_date_end" class="input-small" value="${event_date_end?date}">
                               </div>
							   <a class="btn btn-small" href="jsp/admin/plugins/calendar/OccurrenceList.jsp?plugin_name=calendar&calendar_id=${calendar_id}&event_id=${event.id}&sort_events=${default_sort_event}">
									 <i class="icon-edit"></i>&nbsp;#i18n{calendar.modify_event.buttonLabelmodify} #i18n{calendar.modify_event.periodicity}
								</a>
                            </div>
                        </div>
						<div class="control-group">
							<div class="controls form-inline">
							<label for="event_time_start">#i18n{calendar.create_event.time_start}&nbsp;</label>
                                <div class="input-prepend">
									<span class="add-on">
										<i class="icon-time"></i>
									</span>	
									<input type="text"  title=" (hh:mm) " id="event_time_start" name="event_time_start" tabindex="2" class="input-mini timepicker-default" maxlength="5" value="<#if event.dateTimeStart?exists>${event.dateTimeStart}</#if>" >
                                </div>
								<label  for="event_time_end">#i18n{calendar.create_event.time_end}&nbsp;</label>
                                <div class="input-prepend">
									<span class="add-on">
										<i class="icon-time" title=" (hh:mm) "></i>
									</span>	
									<input type="text" title=" (hh:mm) " id="event_time_end" name="event_time_end" tabindex="3" class="input-mini timepicker-default" maxlength="5" value="<#if event.dateTimeEnd?exists>${event.dateTimeEnd}</#if>">
								</div>
                            </div>
                        </div>
					</div>
                </div>
                <div class="row-fluid">
                    <div class="span12 well well-small">
                        <label for="excluded_days">#i18n{calendar.create_event.excluded_days} : </label>
                        <label class="checkbox inline">
                            <input type="checkbox" value="2" name="excluded_days" <#if isDayExcluded("2", event.excludedDays)> checked="checked" </#if>>#i18n{calendar.label.monday}
                        </label>
                        <label class="checkbox inline">
                            <input type="checkbox" class="checkbox" value="3" name="excluded_days" <#if isDayExcluded("3", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.tuesday}
                        </label>
                        <label class="checkbox inline">
                            <input type="checkbox" class="checkbox" value="4" name="excluded_days" <#if isDayExcluded("4", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.wednesday}
                        </label>
                        <label class="checkbox inline">
                            <input type="checkbox" class="checkbox" value="5" name="excluded_days" <#if isDayExcluded("5", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.thursday}
                        </label>
                        <label class="checkbox inline">
                            <input type="checkbox" class="checkbox" value="6" name="excluded_days" <#if isDayExcluded("6", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.friday}
                        </label>
                        <label class="checkbox inline">
                            <input type="checkbox" class="checkbox" value="7" name="excluded_days" <#if isDayExcluded("7", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.saturday}
                        </label>    
                        <label class="checkbox inline">
                            <input type="checkbox" class="checkbox" value="1" name="excluded_days" <#if isDayExcluded("1", event.excludedDays)> checked="checked" </#if>> #i18n{calendar.label.sunday}
                        </label>
                    </div>
                </div>
				<div class="form-actions">
					<button class="btn btn-primary btn-small" type="submit" >
						<i class="icon-ok icon-white"></i>&nbsp;#i18n{calendar.modify_event.buttonLabelmodify}
					</button>
					<a class="btn btn-small" href="jsp/admin/plugins/calendar/EventList.jsp?plugin_name=calendar&calendar_id=${calendar_id}" >
						<i class="icon-remove-circle"></i>&nbsp;#i18n{calendar.modify_event.backToEventList}
					</a>
				</div>
		</fieldset>
    </div>
	<div class="span3">
        <fieldset>
           <legend>#i18n{calendar.create_event.advanced_parameters}</legend>
				<label class="inline" for="event_category">#i18n{calendar.create_event.category}</label>
                <@multiCombo name="category" list_default_values=category_default_list items=category_list />
				<p class="help-block">#i18n{calendar.modify_event.labelMultiCategorySelection}</p>
				<label class="inline" for="event_image">#i18n{calendar.create_event.imagelink}</label>
                <input type="file" id="event_image" name="event_image" class="input-normal" >
				<img class="thumbnails thumblist-wide" title="${event.imageUrl}" src="${event.imageUrl}" >
                <p>
					<button class="btn btn-link" type="button" id="advparam">
						<i id="ico" class="icon-chevron-down"></i>&nbsp;#i18n{portal.util.labelMore}...
					</button>
				</p>
                <div id="advanced_parameters">
                    <div class="control-group">
                        <label class="control-label" for="event_location">#i18n{calendar.create_event.location} </label>
                        <div class="controls">
                            <input type="text" id="event_location" name="event_location" class="input-normal" maxlength="60" value="<#if event.location?exists>${event.location}</#if>">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="event_location_address">#i18n{calendar.create_event.location.address} </label>
                        <div class="controls">
                            <input type="text" id="event_location_address" name="event_location_address" class="input-normal" maxlength="130" value="<#if event.locationAddress?exists>${event.locationAddress}</#if>">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="event_location_town">#i18n{calendar.create_event.location.town} </label>
                        <div class="controls">
                            <input type="text" id="event_location_town" name="event_location_town" class="input-normal" maxlength="130" value="<#if event.locationTown?exists>${event.locationTown}</#if>">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="event_location_zip">#i18n{calendar.create_event.location.zip}</label>
                        <div class="controls">
                            <input type="text" id="event_location_zip" name="event_location_zip" class="input-small" maxlength="20" value="<#if event.locationZip?exists>${event.locationZip}</#if>">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="event_tags">#i18n{calendar.create_event.tags} </label>
                        <div class="controls">
                            <input type="text" id="event_tags" name="event_tags" class="input-normal" maxlength="130" value="<#if event.listTags?exists>${event.listTags}</#if>">
                            <span class="help-block"> #i18n{calendar.create_event.separator}</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="event_map">#i18n{calendar.create_event.map} </label>
                        <div class="controls">
                            <input type="text" id="event_map_url" name="event_map_url" class="input-normal" maxlength="130"  value="<#if event.mapUrl?exists>${event.mapUrl}</#if>">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="event_linkurl">#i18n{calendar.create_event.linkurl} </label>
                        <div class="controls">
                            <input type="text" id="event_link_url" name="event_link_url" class="input-normal" maxlength="130" value="<#if event.linkUrl?exists>${event.linkUrl}</#if>">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="event_document_id">#i18n{calendar.create_event.documentid}</label>
                        <div class="controls">
							<div class="input-append">
								<input type="text" id="event_document_id" name="event_document_id" class="input-mini" maxlength="130" value="<#if event.documentId?exists>${event.documentId}</#if>">
								<button type="button" class="btn insert-service" data-url="${insert_service_page}">
									<img src="images/admin/skin/plugins/calendar/ed_linkservice2.png">
								</button> 
							</div>
						</div>
                    </div>
                    <div class="control-group">
                        <label class="control-label" for="event_page_url">#i18n{calendar.create_event.pageurl}</label>
                        <div class="controls">
							<div class="input-append">
                            <input type="text" id="event_page_url" name="event_page_url" class="input-normal" maxlength="130"  value="<#if event.pageUrl?exists>${event.pageUrl}</#if>">
								<button type="button" class="btn insert-service" data-url="${insert_service_link_page}">
									<img src="images/admin/skin/plugins/calendar/ed_linkservice2.png">
								</button>
							</div>
                        </div>
                    </div>
                            
                    
                </div>
            </fieldset>
           
        </div>
		</form>
	</fieldset>
</div>
</#escape>
<script>
$(document).ready( function(){
	$(".insert-service").click( function(){
		var page=$(this).attr("data-url");
		window.open(page,"","toolbar=no, scrollbars=yes, status=yes, location=no, directories=no, menubar=no, width=550, height=450");
	});
	
	$("#advanced_parameters").toggle();
	$("#advparam").click( function(){
		$("#advanced_parameters").toggle();
		if( $("#ico").hasClass('icon-chevron-down') ){
			$("#ico").addClass("icon-chevron-up");
			$("#ico").removeClass("icon-chevron-down");
		} else {
			$("#ico").addClass("icon-chevron-down");
			$("#ico").removeClass("icon-chevron-up");
		}
	});
 });  
</script>
<script src="js/jquery/plugins/ui/jquery-ui-1.8.16.custom.min.js"></script>
<script src="js/jquery/plugins/ui/ui.datepicker-${locale}.js"></script>
<script src="js/jquery/plugins/ui/timepicker/jquery-ui-timepicker-addon.js"></script>
<script src="js/jquery/plugins/ui/timepicker/jquery-ui-sliderAccess.js"></script>
<script src="js/jquery/plugins/ui/timepicker/localization/jquery-ui-timepicker-${locale}.js"></script>
<script>$('.timepicker-default').timepicker();</script>
<@getDatePickerRange idFieldFrom="event_date" idFieldTo="event_date_end" language=locale />